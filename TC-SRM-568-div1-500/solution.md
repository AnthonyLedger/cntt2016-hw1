#EqualSums

作者：穆皓远

关键词： 排列 建图 枚举 不等式

##题目简述

求满足如下条件的n行n列矩阵a的个数：

1.所有元素非负，即$$a_{i,j}\ge0$$

2.对于任意两个大小为n的排列p,q，有$$\sum_{i=1}^na_{i,p_i}=\sum_{i=1}^na_{i,q_i}$$

3.满足若干个形如$$a_{i,j}=k$$的条件

答案对1e9+7取模

题目保证不会有无穷多个解

##算法一

排列可以转化为若干个对换，条件2可化简为$$a_{i,j}+a_{k,l}=a_{i,l}+a_{k,j}$$，即$$a_{i,j}-a_{i,l}=a_{k,l}-a_{k,j}$$

容易发现$$a$$可以由$$a_{i,1}$$和$$a_{i,j}-a_{i,j-1}$$唯一确定

但是这样并不容易解决非负的限制，考虑设$$a_{i,j}=b_i+c_j$$

事实上，对于一个特定的$$a$$，这样的$$b_i,c_j$$有无数对，我们取$$min\{b_i\}=0$$作为解

由$$min\{b_i\}=0$$，可得$$a_{i,j}=b_i+c_j\ge min\{b_i\}+c_j=c_j\ge 0$$

所以只需$$b_i,c_j$$均非负，条件1也就迎刃而解

对于条件3，我们可以使用一个常用技巧，$$b_i和-c_j$$连边来表示约束，这样对于每个连通块分别求解再相乘就是答案

而对于每个连通块，我们任取一个元素，枚举它的大小（注意大小不会超过$$max\{k\}$$），同时判整个连通块是否合法即可

不过到此为止我们并未保证$$min\{b_i\}=0$$，考虑使用容斥原理，用类似的做法减掉$$min\{b_i\}>0$$的情况即可

时间复杂度$$O(n*max\{k\})$$

空间复杂度$$O(n^2)$$

##算法二

算法一最后涉及枚举元素，与$$max\{k\}$$的大小相关，可以考虑设出连通块某个元素，再将其它元素用该元素表示，直接解出该元素的范围即可

时间复杂度$$O(n)$$

空间复杂度$$O(n^2)$$