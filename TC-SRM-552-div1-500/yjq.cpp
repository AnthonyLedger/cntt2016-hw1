#include<bits/stdc++.h>
using namespace std;const char sv[2]={'L','P'};const int MAXN=40;const int MAXM=1810;int calc(int s[][MAXN],int l,int r,int i,int j){return s[r+1][j+1]-s[l][j+1]-s[r+1][i]+s[l][i];}int f[MAXM],tmps[MAXN][MAXM],s[2][MAXN][MAXN];int Init(vector<string>&a,int maxi){memset(f,200,sizeof f);memset(tmps,200,sizeof tmps);int tmp=-1,n=a.size(),m=a[0].length();for(int x=0;x<2;x++)for(int i=1;i<=n;i++)for(int j=1;j<=m;j++)s[x][i][j]=s[x][i-1][j]+s[x][i][j-1]-s[x][i-1][j-1]+(a[i-1][j-1]==sv[x]);for(int l=0;l<n;l++){static int cur[1805];memset(cur,200,sizeof cur);for(int r=l;r<n;r++)for(int i=0;i<m;i++)for(int j=i;j<m;j++){int l_c=calc(s[0],l,r,i,j),p_c=calc(s[1],l,r,i,j),po=l_c-p_c+900;cur[po]=max(cur[po],l_c+p_c);tmps[r][po]=max(tmps[r][po],l_c+p_c);}for(int i=0;i<=1800;i++)if(cur[i]>=0)for(int j=max(0,1800-maxi-i);j<=min(1800,1800+maxi-i);j++)if(f[j]>=0)tmp=max(tmp,cur[i]+f[j]);for(int i=0;i<=1800;i++)f[i]=max(f[i],tmps[l][i]);}return tmp;}class FoxAndFlowerShopDivOne{public:int theMaxFlowers(vector<string>flowers,int maxDiff){int ans=Init(flowers,maxDiff);vector<string>els;int n=flowers.size(),m=flowers[0].length();for(int j=0;j<m;j++){string a="";for(int i=0;i<n;i++)a=a+flowers[i][j];els.push_back(a);}ans=max(ans,Init(els,maxDiff));return ans;}};
