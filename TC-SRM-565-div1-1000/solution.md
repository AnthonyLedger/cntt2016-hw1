# TheDivisionGame
作者:陆宇暄

关键词:计数 分类讨论

## 题目简述
给定长度为$$n$$的数组$$a[],b[],c[]$$问满足以下条件的无根树的个数(对大质数取模).
*.有$$n+3$$个点标号分别为$$0,1,2,3,......,n-2,n-1,A,B,C$$
*.树的边权是正整数
*.对于标号为$$x$$的点,和点$$A$$的距离为$$a[x]$$,和点$$B$$的距离为$$b[x]$$,和点$$C$$的距离为$$c[x]$$.

保证$$1 \leq n \leq 50 $$,$$a[],b[],c[] \leq 10^8$$.

## 分析
考虑只有一个数组$$a[]$$的约束的情况,方案数显然等于$$\prod_i(1+\sum_j dis_j<dis_i)$$

考虑如何将题目中的问题转化为该问题,题目中的树可以分为以下几类:
![](/TC-SRM-565-div1-1000/img1.png)
*.对于链状的情况,只需要计算每个点在链上的$$5$$种相对位置即可.
![](/TC-SRM-565-div1-1000/img2.png)
*.对于Y字形的情况,则要考虑$$6$$种相对位置.
![](/TC-SRM-565-div1-1000/img3.png)
每张图相同颜色的情况比较相似,可以共同考虑.
至此,我们有了一个大致框架.

## 算法
显然的,只有一个数组$$a[]$$的约束时,可以排序后快速计算,复杂度为$$O(n \times log(n))$$.

###Y字形部分
对于Y字形,可以枚举中间点$$x$$,然后就可以得到$$A$$,$$B$$,$$C$$的具体信息,就可以判断其他的点在这$$3$$大类中属于哪个大类以及挂在哪个位置,随后调用一个约束的算法即可.
由于树是带编号的,所以不同中间点的树总是不同的,可以把这些答案直接相加得到这个部分的结果.

###链状部分
对于链状的情况,哪个特殊点在中间位置是等价的,不妨设$$A$$点在中间位置.这种情况**不能**直接获得$$A$$,$$B$$,$$C$$的具体信息,枚举很容易造成重复,不是很好统计,有如下两种解决方法:
####枚举+判重
枚举每个点在链上的情况,统计出所有可能的$$pair(dis(A,B),dis(B,C))$$,用一个map判重后类似Y字形部分计算.
####直接干
找到离$$A$$点最近的点$$x$$,$$x$$点**必然**存在于$$A$$,$$B$$,$$C$$所在链上,直接讨论$$x$$点的位置(共有$$4$$种),然后类似Y字形部分计算.

##一些后话
这个题目说得简单(划掉),细节却十分繁琐,分享一下本人调试程序是遇到的一些问题:
*.由于边权要是整数,所以有**很多**时候计算距离要$$/2$$时要先判定是否是$$2$$的倍数.
*.如果一个子树中不存在一个在$$A$$,$$B$$,$$C$$链上的点就会挂不上去,而且不能存在一个以上.
*.map< int,vector< int > >能大大简化代码,千万不要纠结于常数(大佬们当我没说).

