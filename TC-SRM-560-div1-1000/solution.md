# BoundedOptimization

作者：叶昊星

## 关键词

子集枚举，带限制的不等式，拉格朗日乘数法，高斯消元

## 题目大意

定义项为两个不同变量相乘。求一个由多个不同项相加，含有$$n$$个不同变量的式子的最大值。另外限制了每一个变量的最大最小值$$Upperbound_{i}$$和$$Lowerbound_{i}$$和所有变量之和的最大值$$Max$$。

## 数据范围

$$n\leq 13, 0\leq Lowerbound_{i}\leg Upperbound_{i}\leq 100,Max\leq 1300, 2s$$。

## 解法1

注意到如果$$Max\geq \sum Upperbound_{i}$$那么直接将每个变量赋为$$Upperbound_{i}$$即可。

否则设变量为$$x_{i}$$，我们可以得到$$\sum x_{i}=Max$$。

首先考虑如果没有每个变量的上下界怎么做。

设原式为$$max\{\sum a_{i,j}x_{i}x_{j}\}$$，在这道题中$$a_{i,j}$$是由给定式子决定的01变量。

按照拉格朗日乘数法可将式子改写为$$f(\{x\},k)=\sum a_{i,j}x_{i}x_{j}+k*((\sum x_{i})-max)$$。

对$$x_{i}$$和$$k$$分别求偏导，我们假设每个偏导的值均可取到0

则$$\forall 1\leq i\leq n,i\in \mathbb{N},\sum a_{i,j}x_{j}=-k$$且$$\sum x_{i}=Max$$

显然这是一个斜对角为$$0$$的对称矩阵。根据定理对称阵一定有$$N$$个线性无关的特征向量可知一定可以通过高斯消元得到一组满足上述方程的解，此时每个偏导的值均取0。如果有自由元则可以任意赋值。

然后把上下界限制加上。如果原方程的解仍然满足限制，那么该解显然是全局最优解。如果不满足限制，根据调整法易得最优解一定有在边界上的变量。
证明：设$$x_{1}$$和$$x_{2}$$的和是定值且$$x_{1}$$和$$x_{2}$$至少有一个不符合要求且可调整至合法（即和大于等于两者最小值之和且小于等于两者最大值之和）

则原式为$$a_{1,2}x_{1}x_{2}-b_{1}x_{1}-b_{2}x_{2}+c$$，其中$$a_{1,2},b{1},b{2},c$$为定值。

如果$$a_{1,2}=0$$则显然可以将某个变量调整至边界，另一个变量调整至合法，使得答案最优。

否则值最大等价于使$$x_{1}x_{2}-d_{1}x_{1}-d_{2}x_{2}+e=(x_{1}-d_{2})*(x_{2}-d_{1})+f$$最大（其中$$d_{1},d_{2},e,f$$均为可由$$a_{1,2},b_{1},b_{2},c$$表示的定值）

由于原式为无约束情况下的最大值，所以$$x_{1}=d_{2},x_{2}=d_{1}$$。

假设$$x_{1}$$变成$$x_{1}+det$$，那么原式变为$$-det^{2}+f$$，显然$$det$$越接近$$0$$越好，显然两者均不在边界上一定不比有一个在边界上优（前提是两者均合法）。证明完毕。

于是每个变量有三种情况：最大值，最小值，其他值。

这个可以通过子集枚举得到所有情况。

此时上述方程会有些变量变为固定值。

然后就是对于那些标为其他值的变量进行上述操作求最大值（这里假定f取到最大值这些变量都不为最大最小值）

显然如果一种情况下求出来的变量不满足要求那么一定有其中的一个变量不为“其他值”，即不考虑。

显然如果求出来有自由元的情况，我们可以通过将某个变量调整至最大或最小值使$$f$$不变，所以也可以不考虑。（此处包含了变量为自由元和k为自由元的情况）

这样我们可以暴力对每种情况进行计算。复杂度为$$O(3^{n}*n^{3})$$，常数很小，然而不能通过所有数据。

我们发现当其他值的变量集合一定时高斯消元的矩阵也是一定的，于是我们可以先预处理矩阵然后计算。

考虑到矩阵相同时增广矩阵可能不同，我们可以将每个式子的值用一个未知数表示，那么每个变量的值可以用$$O(n)$$项的未知数的多项式表示。

每次计算的时候只需要将每一个未知数$$O(n)$$计算出来即可。总复杂度为$$O(3^n*n^2+2^n*n^3)$$，足以通过全部数据。

### 时空复杂度

$$O(3^{n}*n^{2}+2^{n}*n^{3})-O(2^{n}*n^{2})$$（参考程序做法）或$$O(n^{2})$$

此解法参考程序为131131yhx.cpp

## 解法2

上面的解法显然没有注意到$$a_{x,y}\in \{0,1\}$$的特殊性质。

对于两个其他值变量（假设是$$x_{1}$$和$$x_{2}$$），如果$$a_{1,2}为$$0$$且$$x_{1}+x_{2}$$为定值，那么当其他变量任意取值时，原式可表示为$$-b_{1}x_{1}-b_{2}x_{2}+c$$，此时必然能将某个变量调整至边界，根据上面的论述可知不需要考虑。

所以我们只需要考虑对于所有均属于其他值变量的xi,xj，aij均为1的情况。

对于两个其他值变量（假设是$$x_{1}$$和$$x_{2}$$），根据上述可知$$a_{1,2}=1$$。

于是原式可表示成$$x_{1}x_{2}-b_{1}x_{1}-b_{2}x_{2}+c=(x_{1}-b_{1})*(x_{2}-b_{2})+d$$。

显然当$$x_{1}+x_{2}$$为定值时，$$x_{2}-x_{1}=b_{2}-b_{1}$$时取到最值。

于是可以定义每个变量与$$x_{1}$$的差值，此时我们幸运地找到了一组天然成立的$$f$$为最大值的取值。

至于$$b_{x}-b_{y}$$，由于其他值变量对$$b_{x}$$的贡献由定义可知两者可消去，所以差值完全由最大值或最小值变量提供，这个只要在枚举的时候计算即可。

现在我们知道了其他值变量的总和和每个函数与$$x_{1}$$的差值，于是我们可以$$O(n)$$将每个变量的值计算出来并判断是否合法。

这样就做完了题目。

### 时空复杂度

$$O(3^n*n^2)$$（参考程序做法）或$$O(3^n)-O(n^2)$$

此解法参考程序为sol2.cpp
